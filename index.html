<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>طلب الضيافة — Mishkat</title>

<!-- CSS مودرن بنفسجي بزوايا ناعمة -->
<style>
  :root{
    --bg:#f5f7fb; --card:#ffffff; --primary:#5b21b6; --accent:#7c3aed; --muted:#6b7280;
    --ok:#16a34a; --glass:rgba(255,255,255,0.6);
  }
  *{box-sizing:border-box;font-family: 'Segoe UI', Tahoma, Arial, sans-serif}
  body{margin:0;background:var(--bg);color:#0b1220;padding:22px}
  .container{max-width:1100px;margin:18px auto;display:grid;grid-template-columns:1fr 360px;gap:18px}
  .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(15,23,42,0.06)}
  h1{margin:0 0 6px;font-size:22px;color:var(--primary);text-align:right}
  p.small{color:var(--muted);margin:8px 0 16px;text-align:right}
  /* menu grid */
  .menu{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px}
  .item{background:#fbfbff;border-radius:12px;padding:12px;text-align:center;cursor:pointer;transition:transform .12s,box-shadow .12s;border:2px solid transparent}
  .item img{width:68px;height:68px;object-fit:contain;display:block;margin:6px auto}
  .item strong{display:block;margin-top:6px;font-size:15px}
  .item small{display:block;color:var(--muted);font-size:12px;margin-top:4px}
  .item.active{background:linear-gradient(180deg,#f3e8ff,#fff);border-color:var(--accent);box-shadow:0 8px 18px rgba(124,58,237,0.12);transform:translateY(-4px)}
  /* modifiers */
  .modifiers{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px;justify-content:flex-start}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid #eee;background:#fff;cursor:pointer;color:var(--muted);font-size:14px}
  .chip.active{background:var(--accent);color:#fff;border-color:var(--accent)}
  /* right column */
  label{font-weight:700}
  input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid #e6e6e6;margin-top:8px}
  .btn{display:inline-block;padding:12px 16px;border-radius:10px;border:none;background:var(--primary);color:#fff;cursor:pointer;margin-top:12px}
  .btn.secondary{background:#10b981;margin-left:8px}
  .qrbox{text-align:center;padding:14px;border-radius:10px;background:#fbfbff;margin-top:12px}
  .summary{margin-top:12px;background:#fbfbff;padding:12px;border-radius:10px;font-size:14px}
  footer.note{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
  @media(max-width:980px){.container{grid-template-columns:1fr} .qrbox{margin-top:14px}}
</style>
</head>
<body>

<div class="container">
  <!-- LEFT: menu -->
  <section class="card">
    <h1>أهلاً في ركن الضيافة — Mishkat</h1>
    <p class="small">اضغط على أيقونة المشروب لاختياره — يمكنك اختيار أكثر من عنصر. تحت كل اسم ستجد تسمية بالإنجليزية.</p>

    <div class="menu" id="menu"></div>

    <div class="modifiers" style="margin-top:12px">
      <div class="chip" data-mod="بدون سكر">بدون سكر<br><small>No sugar</small></div>
      <div class="chip" data-mod="سكر قليل">سكر قليل<br><small>Less sugar</small></div>
      <div class="chip" data-mod="سكر وسط">سكر وسط<br><small>Medium sugar</small></div>
      <div class="chip" data-mod="نعناع">نعناع <br><small>mint</small></div>
      <div class="chip" data-mod="بارد">بارد<br><small>Cold</small></div>
      <div class="chip" data-mod="ساخن">ساخن<br><small>Hot</small></div>
    </div>

    <div class="summary" id="summary" style="display:none"></div>
  </section>

  <!-- RIGHT: controls -->
  <aside class="card">
    <label>اسم الضيف / Guest name</label>
    <input id="guestName" type="text" placeholder="مثال: مدير المدرسة — Example: Principal" />

    <label style="margin-top:10px">ملاحظات (اختياري) / Notes (optional)</label>
    <input id="notes" type="text" placeholder="مثال: فنجان صغير — Example: small cup" />

    <div style="margin-top:12px">
      <button class="btn" id="sendBtn">إرسال الطلب الآن — Send Order</button>
      <button class="btn secondary" id="clearBtn">مسح الاختيارات — Clear</button>
    </div>

    <div class="qrbox">
      <div id="qrcodeCanvas"></div>
      <div style="margin-top:8px;color:var(--muted);font-size:13px">امسح QR لفتح نموذج الطلب من الهاتف — Scan to open order page</div>
    </div>

    <div style="margin-top:12px;text-align:center">
      <small class="note" style="color:var(--muted)">شغّل عبر Live Server إن ظهرت مشاكل في الصوت أو Firebase.</small>
    </div>
  </aside>
</div>

<!-- أصوات -->
<audio id="sendSound">
  <source src="https://notificationsounds.com/storage/sounds/file-sounds-1150-pristine.mp3" type="audio/mpeg">
</audio>

<!-- libs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

<script>
/* ===== Firebase v8 config (أدخل الإعدادات الخاصة بك إذا تغيّرت) ===== */
var firebaseConfig = {
  apiKey: "AIzaSyBA8y6Z3CzA0v3UkLG03eOowcCBSwVm4Hk",
  authDomain: "mishkat-coffee.firebaseapp.com",
  databaseURL: "https://mishkat-coffee-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "mishkat-coffee",
  storageBucket: "mishkat-coffee.firebasestorage.app",
  messagingSenderId: "1044002917128",
  appId: "1:1044002917128:web:947c927e9ff26538e17abd"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.database();
/* ================================================================== */

const drinks = [
    {
        id:'قهوة_عربية', name:'قهوة عربية', en:'Arabic Coffee',
        icon:'https://th.bing.com/th/id/OIP.g7475edePrLtYxi5xj9-mwHaHa?w=185'
    },
    {
        id:'شاي_كرك', name:'شاي كرك', en:'Karak Tea',
        icon:'https://th.bing.com/th/id/OIP.593RxZnjedF5cKMVlVtiBwHaEN?w=305'
    },
    {
        id:'قهوة_لاتيه', name:'لاتيه', en:'Latte',
        icon:'https://th.bing.com/th/id/OIP._wuupGpZAD8X0d5a5m1OFQHaHa?w=159'
    },
    {
        id:'كابتشينو', name:'كابتشينو', en:'Cappuccino',
        icon:'https://tse3.mm.bing.net/th/id/OIP.VxEOWW79-dDw0I8wxnVnAAHaHa?w=512'
    },
    {
        id:'ماء', name:'ماء', en:'Water',
        icon:'https://www.google.com/imgres?q=%D8%A7%D9%8A%D9%85%D9%88%D8%AC%D9%8A%20%D8%B9%D9%84%D8%A8%D9%87%20%D9%85%D8%A7%D8%A1&imgurl=https%3A%2F%2Fcdn.salla.sa%2FQezNV%2F6TTJCIyGrAcbNv2zOPuSuqwwBSE09xPZE7rYkoKG.png&imgrefurl=https%3A%2F%2Ftoday-water.com%2Fen%2F%25D8%25AA%25D9%2588%25D8%25B5%25D9%258A%25D9%2584-%25D8%25A7%25D9%2584%25D9%2585%25D8%25B3%25D8%25A7%25D8%25AC%25D8%25AF%2Fp1176529022%3Fsrsltid%3DAfmBOopAaol_V7WgEmlJguXOK9cIdDvwg0s_ePIlz4ZGvEu6sWudu533&docid=cDJ74P5TAfX1dM&tbnid=p0HEWBj5LPpWGM&vet=12ahUKEwiFwuCvo6ORAxW7U0EAHd_rAa8QM3oECF4QAA..i&w=1000&h=855&hcb=2&ved=2ahUKEwiFwuCvo6ORAxW7U0EAHd_rAa8QM3oECF4QAA'
    },
    {
        id:'تمر', name:'تمر', en:'Dates',
        icon:'https://www.google.com/imgres?q=%D8%A7%D9%8A%D9%85%D9%88%D8%AC%D9%8A%20%D8%AA%D9%85%D8%B1&imgurl=https%3A%2F%2Fpng.pngtree.com%2Fpng-vector%2F20230918%2Fourmid%2Fpngtree-dates-fruit-kurma-fruit-png-image_10130982.png&imgrefurl=https%3A%2F%2Far.pngtree.com%2Fso%2F%25D8%25A7%25D9%2584%25D8%25AA%25D9%2585%25D8%25B1&docid=vJaLN6yBSDzSHM&tbnid=TovbZtneXUYQdM&vet=12ahUKEwi_3YDRo6ORAxVsVUEAHYIPAu8QM3oECBoQAA..i&w=360&h=360&hcb=2&ved=2ahUKEwi_3YDRo6ORAxVsVUEAHYIPAu8QM3oECBoQAA'
    },
    {
        id:'شاي_عمق', name:'شاي عُمق', en:'Iced Tea',
        icon:'https://www.google.com/imgres?q=%D8%B4%D8%A7%D9%8A%20%D8%B9%D9%85%D9%82&imgurl=https%3A%2F%2Fcdn.salla.sa%2FxveDw%2FjUrsm24RyqUbbi6kZZsFlodg8U3SLywYDb3TeacZ.jpg&imgrefurl=https%3A%2F%2Fumqcoffee.com%2Far%2FERDdpQ%3Fsrsltid%3DAfmBOorqhqXQitxl9nvwMJ19TNfnZR9KJ-fJJaExqFYmzNkfSVVEmdbw&docid=NOIL8ibPVDdM6M&tbnid=GBgNGZmBu5Q2FM&vet=12ahUKEwjD_Y3fo6ORAxUJXEEAHVoOCfwQM3oECC8QAA..i&w=1000&h=1000&hcb=2&ved=2ahUKEwjD_Y3fo6ORAxUJXEEAHVoOCfwQM3oECC8QAA'
    },
    {
        id:'شاي_اخضر', name:'شاي أخضر', en:'Green Tea',
        icon:'https://img.icons8.com/color/96/green-tea.png'
    },
    {
        id:'معمول', name:'معمول', en:'Maamoul',
        icon:'https://www.google.com/imgres?q=%D8%A7%D9%8A%D9%85%D9%88%D8%AC%D9%8A%20%D9%85%D8%B9%D9%85%D9%88%D9%84&imgurl=https%3A%2F%2Fcdn.salla.sa%2FBDqDw%2FpyxUZ8qDG0bsfyh3qW0fI9GiLLBuHPDruIaLuAWS.jpg&imgrefurl=https%3A%2F%2Fajwadates.sa%2Far%2Fajwa-date-maamoul%2Fp971246436%3Fsrsltid%3DAfmBOooyN8qbMOUIJYmsqt8i6IylXoO6ddQvvFSDCvcG7fUYyf6DVBk9&docid=f-2T0487rcTPwM&tbnid=xOwkAzvxZG6-cM&vet=12ahUKEwj9tICGo6ORAxXFVkEAHfPXCkUQM3oECCAQAA..i&w=1000&h=1000&hcb=2&ved=2ahUKEwj9tICGo6ORAxXFVkEAHfPXCkUQM3oECCAQAA'
    },
    {
        id:'حلا_بارد', name:'حلا بارد', en:'Cool dessert',
        icon:'https://www.emojiall.com/en/header-svg/%F0%9F%8D%AE.svg'
    },
    {
        id:'دونات', name:'دونات', en:'Donut',
        icon:'https://www.google.com/imgres?q=%D8%A7%D9%8A%D9%85%D9%88%D8%AC%D9%8A%20%D8%AF%D9%88%D9%86%D8%A7%D8%AA&imgurl=http%3A%2F%2Foliesgift.com%2Fcdn%2Fshop%2Ffiles%2Ftasty-donuts-sweet-food-enamel-pin-by-realsic-wide.jpg%3Fv%3D1697553353&imgrefurl=https%3A%2F%2Foliesgift.com%2Fproducts%2Fdelicious-cute-donut-emoji-enamel-lapel-pin-for-your-life%3Fsrsltid%3DAfmBOoq7SWdDzj-RMAE6DOvtOmIV75rrDhnRydLS9Iobz5bBoQaAT25e&docid=KNAzsBL4soS6HM&tbnid=xfSUQZgDTSqFnM&vet=12ahUKEwiawoPuo6ORAxUgX0EAHZ26L8wQM3oECBwQAA..i&w=1830&h=1830&hcb=2&ved=2ahUKEwiawoPuo6ORAxUgX0EAHZ26L8wQM3oECBwQAA'
    },
    {
        id:'معجنات', name:'معجنات', en:'Pastries',
        icon:'https://www.google.com/imgres?q=%D8%A7%D9%8A%D9%85%D9%88%D8%AC%D9%8A%20%D9%85%D8%B9%D8%AC%D9%86%D8%A7%D8%AA&imgurl=https%3A%2F%2Fe7.pngegg.com%2Fpngimages%2F944%2F814%2Fpng-clipart-danish-pastry-pan-dulce-panettone-flavor-bread-bread-food-sweetness.png&imgrefurl=https%3A%2F%2Fwww.pngegg.com%2Far%2Fpng-swrou&docid=FMWgwMjMsrLPeM&tbnid=5Gl8ng6UR1PQMM&vet=12ahUKEwj46Ov8o6ORAxVjdUEAHVHjFmYQM3oECCsQAA..i&w=900&h=800&hcb=2&ved=2ahUKEwj46Ov8o6ORAxVjdUEAHVHjFmYQM3oECCsQAA'
    },
    {
        id:'عريكة_فهد', name:'عريكة فهد', en:'Areeka',
        icon:'https://www.google.com/imgres?q=%D8%A7%D9%8A%D9%85%D9%88%D8%AC%D9%8A%20%D8%B9%D8%B1%D9%8A%D9%83%D9%87&imgurl=https%3A%2F%2Fimg-global.cpcdn.com%2Frecipes%2F071ec3b23d08d5bb%2F680x781f0.5_0.501343_1.0q80%2F%25D8%25A7%25D9%2584%25D8%25B5%25D9%2588%25D8%25B1%25D8%25A9-%25D8%25A7%25D9%2584%25D8%25B1%25D8%25A6%25D9%258A%25D8%25B3%25D9%258A%25D8%25A9-%25D9%2584%25D9%2588%25D8%25B5%25D9%2581%25D8%25A9%25D8%25B9%25D8%25B1%25D9%258A%25D9%2583%25D8%25A9-%25D8%25AC%25D9%2586%25D9%2588%25D8%25A8%25D9%258A%25D8%25A9.jpg&imgrefurl=https%3A%2F%2Fcookpad.com%2Fsa%2F%25D9%2588%25D8%25B5%25D9%2581%25D8%25A7%25D8%25AA%2F17258710&docid=9Wbdli6REAcXZM&tbnid=rUTJCb1hjkRWaM&vet=12ahUKEwjRgNyLpKORAxVpT0EAHRpnCboQM3oECBkQAA..i&w=680&h=781&hcb=2&ved=2ahUKEwjRgNyLpKORAxVpT0EAHRpnCboQM3oECBkQAA'
    }
];





/* عناصر الواجهة */
const menuEl = document.getElementById('menu');
const summaryEl = document.getElementById('summary');
const selected = new Map();
const prefs = new Set();

/* render items */
drinks.forEach(d=>{
  const div = document.createElement('div');
  div.className = 'item';
  div.dataset.id = d.id;
  div.innerHTML = `<img src="${d.icon}" alt="${d.name}"><strong>${d.name}</strong><small>${d.en}</small>`;
  div.addEventListener('click', ()=>{
    if(selected.has(d.id)) selected.delete(d.id);
    else selected.set(d.id, { id:d.id, name:d.name });
    div.classList.toggle('active');
    renderSummary();
  });
  menuEl.appendChild(div);
});

/* modifiers chips */
document.querySelectorAll('.chip').forEach(c=>{
  c.addEventListener('click', ()=>{
    const mod = c.dataset.mod;
    if(c.classList.contains('active')) { c.classList.remove('active'); prefs.delete(mod); }
    else { c.classList.add('active'); prefs.add(mod); }
    renderSummary();
  });
});

function renderSummary(){
  if(selected.size === 0 && prefs.size === 0){
    summaryEl.style.display = 'none'; return;
  }
  let html = '<strong>ملخص الطلب / Order summary:</strong><div style="margin-top:8px;text-align:right">';
  if(selected.size>0) html += '<div><b>مشروبات</b> / Drinks: ' + Array.from(selected.values()).map(s=>s.name).join(' ، ') + '</div>';
  if(prefs.size>0) html += '<div><b>تفضيلات</b> / Prefs: ' + Array.from(prefs).join(' ، ') + '</div>';
  summaryEl.innerHTML = html + '</div>';
  summaryEl.style.display = 'block';
}

/* QR Code */
const qr = new QRious({ element: document.createElement('canvas'), size: 170 });
qr.value = window.location.href;
document.getElementById('qrcodeCanvas').appendChild(qr.element);

/* Generate order number: 4-digit incremental using Firebase counter */
function generateOrderNumber(callback){
  // try to use a counter in DB (transaction)
  const counterRef = db.ref('meta/orderCounter');
  counterRef.transaction(current=>{
    return (current || 0) + 1;
  }, function(err, committed, snapshot){
    if(err || !committed){
      // fallback to random 4-digit
      const rnd = Math.floor(1000 + Math.random()*9000);
      callback(rnd);
    } else {
      callback(snapshot.val());
    }
  });
}

/* send order */
document.getElementById('sendBtn').addEventListener('click', ()=> {
  const name = document.getElementById('guestName').value.trim();
  const notes = document.getElementById('notes').value.trim();
  if(!name){ alert('الرجاء كتابة اسم الضيف — Please enter your name.'); return; }
  if(selected.size === 0){ alert('الرجاء اختيار مشروب واحد على الأقل — Choose at least one drink.'); return; }

  // build order
  const items = Array.from(selected.values()).map(s=>({ id:s.id, name:s.name }));
  const preferences = Array.from(prefs);

  // generate number then push
  generateOrderNumber(orderNum=>{
    const order = {
      orderNum: orderNum,
      name: name,
      items: items,
      prefs: preferences,
      notes: notes,
      time: new Date().toLocaleString()
    };
    db.ref('orders').push(order, err=>{
      if(err){ alert('حدث خطأ. حاول مرة أخرى.'); console.error(err); }
      else {
        // play sound (user initiated click => should play)
        const snd = document.getElementById('sendSound');
        snd.currentTime = 0;
        snd.play().catch(()=>{ /* ignored if blocked */ });

        alert('تم إرسال الطلب بنجاح ✔\\nرقم الطلب / Order number: ' + orderNum);
        // reset UI
        selected.clear(); prefs.clear();
        document.querySelectorAll('.item').forEach(el=>el.classList.remove('active'));
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        document.getElementById('guestName').value = '';
        document.getElementById('notes').value = '';
        renderSummary();
      }
    });
  });
});

/* clear button */
document.getElementById('clearBtn').addEventListener('click', ()=>{
  selected.clear(); prefs.clear();
  document.querySelectorAll('.item').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
  renderSummary();
});
</script>
</body>
</html>





